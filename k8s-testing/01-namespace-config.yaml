# ============================================================================
# TESTING ENVIRONMENT CONFIGURATION
# ============================================================================
# Optimized for local Kubernetes cluster (k3d/minikube)
# Single replica per service, no SSL, local domain access
# ============================================================================

---
# NAMESPACE
apiVersion: v1
kind: Namespace
metadata:
  name: virtual-vacation
  labels:
    name: virtual-vacation
    environment: testing

---
# SERVICE ACCOUNT FOR SECURE ACCESS
apiVersion: v1
kind: ServiceAccount
metadata:
  name: virtual-vacation-sa
  namespace: virtual-vacation
  labels:
    app: virtual-vacation

---
# CONFIGMAP - APPLICATION CONFIGURATION (TESTING)
apiVersion: v1
kind: ConfigMap
metadata:
  name: virtual-vacation-config
  namespace: virtual-vacation
  labels:
    app: virtual-vacation
data:
  # Application Settings
  NODE_ENV: "development"
  VITE_APP_ENV: "development"
  REACT_APP_ENVIRONMENT: "development"

  # Server Configuration
  PORT: "5000"
  FRONTEND_PORT: "3000"
  BACKEND_PORT: "8000"

  # Database Configuration
  POSTGRES_DB: "virtual_vacation"
  POSTGRES_USER: "vacation_user"
  DATABASE_URL: "postgresql://vacation_user@postgres-service:5432/virtual_vacation"

  # Redis Configuration
  REDIS_URL: "redis://redis-service:6379"
  REDIS_DB: "0"

  # Rate Limiting - RELAXED FOR TESTING
  RATE_LIMIT_WINDOW_MS: "900000"
  RATE_LIMIT_MAX_REQUESTS: "1000"

  # Session Configuration
  SESSION_COOKIE_SECURE: "false"
  SESSION_COOKIE_HTTPONLY: "true"
  SESSION_COOKIE_SAMESITE: "lax"

  # CORS Configuration - LOCAL
  CORS_ORIGIN: "http://localhost:3000,http://localhost,http://127.0.0.1"

  # API URLs for Frontend
  VITE_API_BASE_URL: "http://localhost/api"
  VITE_WS_URL: "ws://localhost/socket.io"

  # Logging
  LOG_LEVEL: "debug"
  LOG_FORMAT: "text"

  # Performance
  COMPRESSION_LEVEL: "6"
  CACHE_TTL: "3600"

---
# SECRET - SENSITIVE CONFIGURATION (TESTING)
apiVersion: v1
kind: Secret
metadata:
  name: virtual-vacation-secrets
  namespace: virtual-vacation
  labels:
    app: virtual-vacation
type: Opaque
stringData:
  # Database
  POSTGRES_PASSWORD: "vacation_password"

  # JWT & Sessions
  JWT_SECRET: "testing-jwt-secret-change-in-production"
  SESSION_SECRET: "testing-session-secret-change-in-production"

  # API Keys - MUST BE PROVIDED FOR FULL FUNCTIONALITY
  # Get free keys from:
  # - Google Maps: https://console.cloud.google.com/google/maps-apis
  # - OpenWeather: https://openweathermap.org/api
  # - Unsplash: https://unsplash.com/developers
  # - Freesound: https://freesound.org/apiv2/
  GOOGLE_MAPS_API_KEY: "CONFIGURE_YOUR_API_KEY_HERE"
  OPENWEATHER_API_KEY: "CONFIGURE_YOUR_API_KEY_HERE"
  UNSPLASH_ACCESS_KEY: "CONFIGURE_YOUR_API_KEY_HERE"
  FREESOUND_API_KEY: "CONFIGURE_YOUR_API_KEY_HERE"
  SKETCHFAB_API_KEY: "CONFIGURE_YOUR_API_KEY_HERE"

  # Optional APIs
  NEWS_API_KEY: ""
  MAPBOX_ACCESS_TOKEN: ""

---
# RESOURCE QUOTA - TESTING (RELAXED)
apiVersion: v1
kind: ResourceQuota
metadata:
  name: virtual-vacation-resource-quota
  namespace: virtual-vacation
spec:
  hard:
    requests.cpu: "2"
    requests.memory: "4Gi"
    limits.cpu: "4"
    limits.memory: "8Gi"
    persistentvolumeclaims: "5"
    pods: "30"

---
# LIMIT RANGE - TESTING
apiVersion: v1
kind: LimitRange
metadata:
  name: virtual-vacation-limit-range
  namespace: virtual-vacation
spec:
  limits:
    - default:
        cpu: "500m"
        memory: "512Mi"
      defaultRequest:
        cpu: "100m"
        memory: "128Mi"
      type: Container
